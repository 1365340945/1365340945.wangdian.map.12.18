<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>网点地图</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #fff; } /* 背景设为白色，完全空白 */
        .map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #eee;
            transition: all 0.3s ease;
            width: 280px;
            overflow: hidden;
            display: none; /* 初始隐藏 */
        }
        .map-controls.collapsed { width: 50px; }
        .control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .control-header h3 { font-size: 14px; font-weight: bold; color: #333; margin: 0; }
        .collapse-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .control-content { padding: 12px; transition: all 0.3s ease; }
        .map-controls.collapsed .control-content { display: none; }
        .province-city-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        .province-city-select select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
        }
        .province-city-select button {
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
        }
        .btn-group button {
            padding: 8px 0;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        .select-btn { background: #007bff; }
        .select-btn.active { background: #dc3545; }
        .calc-btn { background: #17a2b8; }
        .calc-btn:disabled { background: #ccc; cursor: not-allowed; }
        .clear-btn { background: #6c757d; }
        .sub-title {
            font-size: 12px;
            font-weight: bold;
            color: #333;
            margin: 10px 0 6px 0;
            padding-bottom: 4px;
            border-bottom: 1px solid #eee;
        }
        .distance-result {
            margin-top: 8px;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
            min-height: 80px;
            max-height: 180px;
            overflow-y: auto;
            line-height: 1.4;
        }
        #map { 
            width: 100vw; 
            height: 100vh; 
            background: #f5f5f5; 
            display: none; /* 初始隐藏 */
        }
        .marker-color-red { filter: hue-rotate(-15deg) saturate(4) !important; }
        .marker-color-blue { filter: hue-rotate(190deg) saturate(4) !important; }
        .marker-color-green { filter: hue-rotate(110deg) saturate(4) !important; }
        .marker-selected {
            filter: brightness(1.2) !important;
            transform: scale(1.2);
            transition: all 0.2s;
        }
        .location-label {
            pointer-events: none;
            white-space: normal;
            z-index: 999;
            text-align: center;
            width: max-content;
            transform: translateX(-50%);
        }
		.location-label span {
			font-family: "Microsoft YaHei", 微软雅黑, "Heiti SC", sans-serif;
			font-size: 12px;
			font-weight: 600;
			color: #000 !important;
			background: transparent;
			padding: 0 4px;
			-webkit-text-stroke: 0;
			text-stroke: 0;
			text-shadow: 1px 0 1px #fff,
						 -1px 0 1px #fff,
						 0 1px 2px #fff,
						 0 -1px 1px #fff;
			display: inline-block;
			width: 90px;
			word-break: break-all;
			white-space: normal;
			line-height: 1.2;
		}

		/* 新增：面板内缩小版筛选按钮样式 */
		.panel-filter-buttons {
		  margin-bottom: 10px; /* 和下方内容隔开 */
		  display: flex; /* 水平排列 */
		  gap: 5px; /* 按钮间距 */
		}
		.filter-btn-sm {
		  padding: 4px 8px; /* 缩小内边距（核心缩小点） */
		  border: none;
		  border-radius: 3px; /* 圆角更小巧 */
		  cursor: pointer;
		  font-size: 11px; /* 缩小字体 */
		  transition: all 0.2s;
		  color: white;
		  min-width: 30px; /* 保证按钮紧凑且不挤压 */
		}
		/* 不同颜色按钮基础样式 */
		.filter-green { background-color: #dc3545; }
		.filter-blue { background-color: #dc3545; }
		.filter-red { background-color: #dc3545; }
		/* 激活/禁用状态（点击切换） */
		.filter-btn-sm.active { opacity: 1; }
		.filter-btn-sm:not(.active) { opacity: 0.5; background-color: #6c757d; }
		.filter-btn-sm:hover { opacity: 1; /*  hover时恢复高亮 */ }

		
        .leaflet-control-zoom, .leaflet-attribution-control { display: none; }
    </style>
</head>
<body>
    <div class="map-controls" id="mapControls">
        <div class="control-header" id="controlHeader">
            <h3>地图操作面板</h3>
            <button class="collapse-btn" id="collapseBtn">≡</button>
        </div>
        <div class="control-content">
			
			  <!-- 新增：面板内缩小版筛选按钮（放在最上方） -->
			  <div class="panel-filter-buttons">
				<button class="filter-btn-sm filter-green active" data-color="green">东兴</button>
				<button class="filter-btn-sm filter-blue active" data-color="blue">信达</button>
				<button class="filter-btn-sm filter-red active" data-color="red">中金</button>
			  </div>
			
            <div class="province-city-select">
                <select id="provinceSelect">
                    <option value="">请选择省份</option>
                </select>
                <select id="citySelect" disabled>
                    <option value="">请选择城市</option>
                </select>
                <button id="locationBtn">定位到所选区域</button>
            </div>
            <!-- 已删除编辑模式相关按钮 -->
            <div class="sub-title">距离计算工具</div>
            <div class="btn-group">
                <button id="selectMarkerBtn" class="select-btn">选择点位（点击标记）</button>
                <button id="calcDistanceBtn" class="calc-btn" disabled>计算所有两两距离</button>
                <button id="clearSelectBtn" class="clear-btn">清空选中点位</button>
            </div>
            <div class="distance-result" id="distanceResult">
                1. 可选择省市定位到对应区域<br>
                2. 点击「选择点位」选中地图标记<br>
                3. 选择≥2个点位计算两两距离
            </div>
        </div>
    </div>

    <div id="map"></div>

    <script>
        // 扩展L.Icon
        L.Icon.ColorMarker = L.Icon.extend({
            options: {
                iconUrl: 'https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
                shadowUrl: 'https://cdn.bootcdn.net/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41],
                colorClass: ''
            },
            initialize: function(options) {
                L.Util.setOptions(this, options);
                this.options.className = this.options.colorClass;
                L.Icon.prototype.initialize.call(this, this.options);
            }
        });
        L.icon.colorMarker = function(options) { return new L.Icon.ColorMarker(options); };

        // GCJ2WGS转换函数
        var PI = 3.14159265358979324;
        function transformGCJ2WGS(gcjLat, gcjLon) {
            let d = delta(gcjLat, gcjLon)
            return {
              'lat': gcjLat - d.lat,
              'lon': gcjLon - d.lon
            }
        }
        function delta(lat, lon) {
            let a = 6378245.0 
            let ee = 0.00669342162296594323 
            let dLat = transformLat(lon - 105.0, lat - 35.0)
            let dLon = transformLon(lon - 105.0, lat - 35.0)
            let radLat = lat / 180.0 * PI
            let magic = Math.sin(radLat)
            magic = 1 - ee * magic * magic
            let sqrtMagic = Math.sqrt(magic)
            dLat = (dLat * 180.0) / ((a * (1 - ee)) / (magic * sqrtMagic) * PI)
            dLon = (dLon * 180.0) / (a / sqrtMagic * Math.cos(radLat) * PI)
            return {
              'lat': dLat,
              'lon': dLon
            }
        }
        function transformLat(x, y) {
            let ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x))
            ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0
            ret += (20.0 * Math.sin(y * PI) + 40.0 * Math.sin(y / 3.0 * PI)) * 2.0 / 3.0
            ret += (160.0 * Math.sin(y / 12.0 * PI) + 320 * Math.sin(y * PI / 30.0)) * 2.0 / 3.0
            return ret
        }
        function transformLon(x, y) {
            let ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x))
            ret += (20.0 * Math.sin(6.0 * x * PI) + 20.0 * Math.sin(2.0 * x * PI)) * 2.0 / 3.0
            ret += (20.0 * Math.sin(x * PI) + 40.0 * Math.sin(x / 3.0 * PI)) * 2.0 / 3.0
            ret += (150.0 * Math.sin(x / 12.0 * PI) + 300.0 * Math.sin(x / 30.0 * PI)) * 2.0 / 3.0
            return ret
        }

        // 核心配置
        let map;
        let isSelectingMarkers = false;
        let selectedPoints = [];
        let locationMarker = null; 
        let locationLabelMarker = null;
        const colorMarkerGroups = {
            'marker-color-green': { markers: [], labels: [] },
            'marker-color-blue': { markers: [], labels: [] },
            'marker-color-red': { markers: [], labels: [] }
        };

        // 固定点位数据（原始GCJ坐标，永不修改）
        const PLACES = [
{ name:'东兴-合肥分公司', lng:117.277500, lat:31.879578, colorClass:'marker-color-green' },
{ name:'东兴-合肥潜山路', lng:117.233911, lat:31.811451, colorClass:'marker-color-green' },
{ name:'东兴-北京大望路', lng:116.490877, lat:39.894606, colorClass:'marker-color-green' },
{ name:'东兴-北京金宝街', lng:116.433274, lat:39.915215, colorClass:'marker-color-green' },
{ name:'东兴-北京中关村大街', lng:116.313152, lat:39.984581, colorClass:'marker-color-green' },
{ name:'东兴-北京复兴路', lng:116.285648, lat:39.908428, colorClass:'marker-color-green' },
{ name:'东兴-北京北四环中路', lng:116.366018, lat:39.988587, colorClass:'marker-color-green' },
{ name:'东兴-北京金融大街', lng:116.365181, lat:39.916946, colorClass:'marker-color-green' },
{ name:'东兴-福清景观大道', lng:119.361158, lat:25.720177, colorClass:'marker-color-green' },
{ name:'东兴-福建分公司', lng:119.307007, lat:26.094434, colorClass:'marker-color-green' },
{ name:'东兴-福州五四路', lng:119.306552, lat:26.101288, colorClass:'marker-color-green' },
{ name:'东兴-福州杨桥中路', lng:119.286462, lat:26.083399, colorClass:'marker-color-green' },
{ name:'东兴-福州五一北路', lng:119.309550, lat:26.079768, colorClass:'marker-color-green' },
{ name:'东兴-福州江厝路', lng:119.296973, lat:26.113376, colorClass:'marker-color-green' },
{ name:'东兴-福州斗西路', lng:119.302420, lat:26.074270, colorClass:'marker-color-green' },
{ name:'东兴-福州学军路', lng:119.307949, lat:26.056592, colorClass:'marker-color-green' },
{ name:'东兴-福州五一中路', lng:119.312767, lat:26.069744, colorClass:'marker-color-green' },
{ name:'东兴-福州长乐郑和中路', lng:119.515834, lat:25.957377, colorClass:'marker-color-green' },
{ name:'东兴-龙岩华莲路', lng:117.016471, lat:25.077886, colorClass:'marker-color-green' },
{ name:'东兴-邵武五一九路', lng:117.492247, lat:27.339149, colorClass:'marker-color-green' },
{ name:'东兴-顺昌中山中路', lng:117.810501, lat:26.792628, colorClass:'marker-color-green' },
{ name:'东兴-南平滨江中路', lng:118.181806, lat:26.637503, colorClass:'marker-color-green' },
{ name:'东兴-宁德闽东中路', lng:119.549116, lat:26.665218, colorClass:'marker-color-green' },
{ name:'东兴-莆田梅园东路', lng:119.013630, lat:25.434860, colorClass:'marker-color-green' },
{ name:'东兴-德化浔南西路', lng:118.225957, lat:25.493968, colorClass:'marker-color-green' },
{ name:'东兴-泉州丰泽街',  lng:118.607194, lat:24.903007, colorClass:'marker-color-green' },
{ name:'东兴-泉州田安路', lng:118.608875, lat:24.906960, colorClass:'marker-color-green' },
{ name:'东兴-惠安建设南路', lng:118.797653, lat:25.028638, colorClass:'marker-color-green' },
{ name:'东兴-晋江世纪大道', lng:118.567346, lat:24.804528, colorClass:'marker-color-green' },
{ name:'东兴-石狮濠江路', lng:118.654859, lat:24.732721, colorClass:'marker-color-green' },
{ name:'东兴-永春八二三东路', lng:118.293469, lat:25.321497, colorClass:'marker-color-green' },
{ name:'东兴-将乐府前东路', lng:117.474487, lat:26.731720, colorClass:'marker-color-green' },
{ name:'东兴-明溪新大路', lng:117.202436, lat:26.357918, colorClass:'marker-color-green' },
{ name:'东兴-宁化中环中路', lng:116.663432, lat:26.260682, colorClass:'marker-color-green' },
{ name:'东兴-三明列东街', lng:117.635845, lat:26.268414, colorClass:'marker-color-green' },
{ name:'东兴-三明崇宁路', lng:117.610313, lat:26.233297, colorClass:'marker-color-green' },
{ name:'东兴-沙县李纲中路', lng:117.793042, lat:26.394719, colorClass:'marker-color-green' },
{ name:'东兴-永安牺和路', lng:117.363828, lat:25.969545, colorClass:'marker-color-green' },
{ name:'东兴-厦门分公司', lng:118.085694, lat:24.468680, colorClass:'marker-color-green' },
{ name:'东兴-厦门鹭江道', lng:118.075749, lat:24.452319, colorClass:'marker-color-green' },
{ name:'东兴-漳州台商投资区文圃大道', lng:117.899336, lat:24.521863, colorClass:'marker-color-green' },
{ name:'东兴-龙海锦江东路', lng:117.817204, lat:24.443381, colorClass:'marker-color-green' },
{ name:'东兴-南靖教育路', lng:117.359670, lat:24.511366, colorClass:'marker-color-green' },
{ name:'东兴-漳州南昌中路', lng:117.668890, lat:24.509551, colorClass:'marker-color-green' },
{ name:'东兴-佛山汾江南路', lng:113.108126, lat:22.995610, colorClass:'marker-color-green' },
{ name:'东兴-广州分公司', lng:113.327075, lat:23.117246, colorClass:'marker-color-green' },
{ name:'东兴-广州体育西路', lng:113.320803, lat:23.139193, colorClass:'marker-color-green' },
{ name:'东兴-深圳分公司', lng:114.055471, lat:22.545171, colorClass:'marker-color-green' },
{ name:'东兴-深圳金田路', lng:114.063656, lat:22.544045, colorClass:'marker-color-green' },
{ name:'东兴-深圳海德三道', lng:113.942969, lat:22.518897, colorClass:'marker-color-green' },
{ name:'东兴-南宁分公司', lng:108.372098, lat:22.821605, colorClass:'marker-color-green' },
{ name:'东兴-石家庄中山西路', lng:114.479147, lat:38.040882, colorClass:'marker-color-green' },
{ name:'东兴-郑州金水路', lng:113.691225, lat:34.763733, colorClass:'marker-color-green' },
{ name:'东兴-武汉台北一路', lng:114.274719, lat:30.593261, colorClass:'marker-color-green' },
{ name:'东兴-长沙韶山北路', lng:112.996514, lat:28.187598, colorClass:'marker-color-green' },
{ name:'东兴-江苏分公司&庐山路营业部', lng:118.726571, lat:31.997536, colorClass:'marker-color-green' },
{ name:'东兴-南京竹山路', lng:118.900037, lat:31.914382, colorClass:'marker-color-green' },
{ name:'东兴-南京汉中路', lng:118.769654, lat:32.042462, colorClass:'marker-color-green' },
{ name:'东兴-苏州分公司&大道西营业部', lng:120.669323, lat:31.314716, colorClass:'marker-color-green' },
{ name:'东兴-盐城青年东路', lng:120.206217, lat:33.396020, colorClass:'marker-color-green' },
{ name:'东兴-南昌分公司', lng:115.863758, lat:28.687052, colorClass:'marker-color-green' },
{ name:'东兴-大连昆明街', lng:121.637193, lat:38.918522, colorClass:'marker-color-green' },
{ name:'东兴-沈阳青年大街', lng:123.434406, lat:41.776635, colorClass:'marker-color-green' },
{ name:'东兴-山东分公司', lng:117.130448, lat:36.656803, colorClass:'marker-color-green' },
{ name:'东兴-济南文化西路', lng:117.031721, lat:36.654325, colorClass:'marker-color-green' },
{ name:'东兴-临沂金雀山路', lng:118.361240, lat:35.050577, colorClass:'marker-color-green' },
{ name:'东兴-青岛香港东路', lng:120.457892, lat:36.090488, colorClass:'marker-color-green' },
{ name:'东兴-烟台南大街', lng:121.371840, lat:37.543258, colorClass:'marker-color-green' },
{ name:'东兴-太原晋阳街', lng:112.567836, lat:37.788955, colorClass:'marker-color-green' },
{ name:'东兴-西安翠华路', lng:108.955946, lat:34.192592, colorClass:'marker-color-green' },
{ name:'东兴-西安分公司', lng:108.883806, lat:34.190865, colorClass:'marker-color-green' },
{ name:'东兴-上海虹口区杨树浦路', lng:121.515675, lat:31.250760, colorClass:'marker-color-green' },
{ name:'东兴-上海分公司&陆家嘴营业部', lng:121.503511, lat:31.242125, colorClass:'marker-color-green' },
{ name:'东兴-上海肇嘉浜路', lng:121.448603, lat:31.198065, colorClass:'marker-color-green' },
{ name:'东兴-成都都江堰市彩虹大道', lng:103.654825, lat:30.987665, colorClass:'marker-color-green' },
{ name:'东兴-成都分公司', lng:104.070320, lat:30.585515, colorClass:'marker-color-green' },
{ name:'东兴-成都二环路南二段', lng:104.071045, lat:30.620644, colorClass:'marker-color-green' },
{ name:'东兴-天津南马路', lng:117.175295, lat:39.137706, colorClass:'marker-color-green' },
{ name:'东兴-昌吉屯河路', lng:87.327440, lat:44.004158, colorClass:'marker-color-green' },
{ name:'东兴-新疆分公司&乌鲁木齐新华北路营业部', lng:87.611370, lat:43.796254, colorClass:'marker-color-green' },
{ name:'东兴-奎屯北京东路', lng:84.905601, lat:44.425460, colorClass:'marker-color-green' },
{ name:'东兴-杭州绍兴路', lng:120.175204, lat:30.289789, colorClass:'marker-color-green' },
{ name:'东兴-杭州分公司', lng:120.213251, lat:30.248972, colorClass:'marker-color-green' },
{ name:'东兴-宁波江东北路', lng:121.571321, lat:29.884497, colorClass:'marker-color-green' },
{ name:'东兴-重庆分公司', lng:106.569511, lat:29.575577, colorClass:'marker-color-green' },
{ name:'东兴-重庆万州', lng:108.377445, lat:30.809855, colorClass:'marker-color-green' },
{ name:'东兴-重庆邹容路', lng:106.574495, lat:29.557861, colorClass:'marker-color-green' },
{ name:'信达-蚌埠龙腾路', lng:117.387511, lat:32.910786, colorClass:'marker-color-blue' },
{ name:'信达-安徽分公司', lng:117.287802, lat:31.717812, colorClass:'marker-color-blue' },
{ name:'信达-合肥东流路', lng:117.257689, lat:31.816139, colorClass:'marker-color-blue' },
{ name:'信达-北京东四环中路', lng:116.488275, lat:39.916915, colorClass:'marker-color-blue' },
{ name:'信达-北京北四环东路', lng:116.425477, lat:39.988281, colorClass:'marker-color-blue' },
{ name:'信达-北京东长安街', lng:116.427004, lat:39.915131, colorClass:'marker-color-blue' },
{ name:'信达-北京科丰桥', lng:116.288921, lat:39.820678, colorClass:'marker-color-blue' },
{ name:'信达-北京中关村南大街', lng:116.323758, lat:39.959335, colorClass:'marker-color-blue' },
{ name:'信达-北京五棵松', lng:116.282900, lat:39.912514, colorClass:'marker-color-blue' },
{ name:'信达-北京牡丹园', lng:116.369485, lat:39.977469, colorClass:'marker-color-blue' },
{ name:'信达-北京分公司', lng:116.202489, lat:39.908174, colorClass:'marker-color-blue' },
{ name:'信达-北京西单北大街', lng:116.372564, lat:39.913233, colorClass:'marker-color-blue' },
{ name:'信达-福建分公司', lng:119.307080, lat:26.091268, colorClass:'marker-color-blue' },
{ name:'信达-泉州丰泽街', lng:118.609883, lat:24.901504, colorClass:'marker-color-blue' },
{ name:'信达-厦门高林中路', lng:118.182601, lat:24.506273, colorClass:'marker-color-blue' },
{ name:'信达-厦门分公司', lng:118.104901, lat:24.473064, colorClass:'marker-color-blue' },
{ name:'信达-漳州新华东路', lng:117.661181, lat:24.510107, colorClass:'marker-color-blue' },
{ name:'信达-东莞元美路', lng:113.746274, lat:23.013256, colorClass:'marker-color-blue' },
{ name:'信达-佛山季华六路', lng:113.137758, lat:23.013242, colorClass:'marker-color-blue' },
{ name:'信达-广州番禺富华东路', lng:113.368848, lat:22.947391, colorClass:'marker-color-blue' },
{ name:'信达-广州新港西路', lng:113.294334, lat:23.092844, colorClass:'marker-color-blue' },
{ name:'信达-广东分公司', lng:113.319732, lat:23.117952, colorClass:'marker-color-blue' },
{ name:'信达-广州金硕一路', lng:113.376193, lat:23.112236, colorClass:'marker-color-blue' },
{ name:'信达-茂名迎宾路', lng:110.903590, lat:21.647168, colorClass:'marker-color-blue' },
{ name:'信达-深圳分公司', lng:114.055610, lat:22.538136, colorClass:'marker-color-blue' },
{ name:'信达-深圳深南东路', lng:114.114380, lat:22.541990, colorClass:'marker-color-blue' },
{ name:'信达-深圳湾科技生态园', lng:113.952743, lat:22.530351, colorClass:'marker-color-blue' },
{ name:'信达-湛江金沙湾', lng:110.381241, lat:21.272102, colorClass:'marker-color-blue' },
{ name:'信达-湛江坡头', lng:110.446192, lat:21.255371, colorClass:'marker-color-blue' },
{ name:'信达-湛江观海路', lng:110.423245, lat:21.214324, colorClass:'marker-color-blue' },
{ name:'信达-湛江徐闻', lng:110.176981, lat:20.329744, colorClass:'marker-color-blue' },
{ name:'信达-海南分公司', lng:110.298286, lat:20.021339, colorClass:'marker-color-blue' },
{ name:'信达-河北分公司', lng:114.523692, lat:38.024145, colorClass:'marker-color-blue' },
{ name:'信达-许昌毓秀路', lng:113.844554, lat:34.018768, colorClass:'marker-color-blue' },
{ name:'信达-河南分公司', lng:113.672758, lat:34.784013, colorClass:'marker-color-blue' },
{ name:'信达-湖北分公司', lng:114.310820, lat:30.610846, colorClass:'marker-color-blue' },
{ name:'信达-长沙八一路', lng:112.992076, lat:28.198277, colorClass:'marker-color-blue' },
{ name:'信达-常州金水岸', lng:119.958769, lat:31.768417, colorClass:'marker-color-blue' },
{ name:'信达-江苏分公司', lng:118.718500, lat:31.987366, colorClass:'marker-color-blue' },
{ name:'信达-南京汉中门大街', lng:118.755007, lat:32.037559, colorClass:'marker-color-blue' },
{ name:'信达-苏州分公司', lng:120.714690, lat:31.323039, colorClass:'marker-color-blue' },
{ name:'信达-无锡金融一街', lng:120.306583, lat:31.489007, colorClass:'marker-color-blue' },
{ name:'信达-鞍山解放东路', lng:123.007565, lat:41.082521, colorClass:'marker-color-blue' },
{ name:'信达-本溪本溪', lng:124.121761, lat:41.298681, colorClass:'marker-color-blue' },
{ name:'信达-本溪桓仁', lng:125.360458, lat:41.272277, colorClass:'marker-color-blue' },
{ name:'信达-本溪樱花街', lng:123.818550, lat:41.307060, colorClass:'marker-color-blue' },
{ name:'信达-本溪曙光路', lng:123.761174, lat:41.287958, colorClass:'marker-color-blue' },
{ name:'信达-凌源凌河街', lng:119.400397, lat:41.233921, colorClass:'marker-color-blue' },
{ name:'信达-朝阳五一街', lng:120.456483, lat:41.575436, colorClass:'marker-color-blue' },
{ name:'信达-大连人民路', lng:121.647418, lat:38.922434, colorClass:'marker-color-blue' },
{ name:'信达-东港东港路', lng:124.149360, lat:39.883599, colorClass:'marker-color-blue' },
{ name:'信达-丹东凤城', lng:124.067484, lat:40.454023, colorClass:'marker-color-blue' },
{ name:'信达-丹东锦山大街', lng:124.395288, lat:40.133699, colorClass:'marker-color-blue' },
{ name:'信达-丹东青年大街', lng:124.383866, lat:40.118307, colorClass:'marker-color-blue' },
{ name:'信达-抚顺临江东路', lng:123.965705, lat:41.883991, colorClass:'marker-color-blue' },
{ name:'信达-阜新解放大街', lng:121.656918, lat:42.011532, colorClass:'marker-color-blue' },
{ name:'信达-葫芦岛兴工街', lng:120.852898, lat:40.760080, colorClass:'marker-color-blue' },
{ name:'信达-葫芦岛龙湾大街', lng:120.861305, lat:40.729254, colorClass:'marker-color-blue' },
{ name:'信达-锦州科技路', lng:121.130914, lat:41.090605, colorClass:'marker-color-blue' },
{ name:'信达-辽阳武圣路', lng:123.179964, lat:41.268438, colorClass:'marker-color-blue' },
{ name:'信达-辽阳工农大街', lng:123.205631, lat:41.196106, colorClass:'marker-color-blue' },
{ name:'信达-盘锦红旗大街', lng:122.030857, lat:41.194670, colorClass:'marker-color-blue' },
{ name:'信达-盘锦兴隆台街', lng:122.097487, lat:41.170388, colorClass:'marker-color-blue' },
{ name:'信达-沈阳市府大路', lng:123.415081, lat:41.804094, colorClass:'marker-color-blue' },
{ name:'信达-沈阳北陵大街', lng:123.429304, lat:41.826699, colorClass:'marker-color-blue' },
{ name:'信达-辽宁分公司', lng:123.452914, lat:41.744990, colorClass:'marker-color-blue' },
{ name:'信达-沈阳北站路', lng:123.435577, lat:41.814219, colorClass:'marker-color-blue' },
{ name:'信达-沈阳建设东路', lng:123.377173, lat:41.790716, colorClass:'marker-color-blue' },
{ name:'信达-新民辽河大街', lng:122.834671, lat:41.987977, colorClass:'marker-color-blue' },
{ name:'信达-调兵山迎宾路', lng:123.549250, lat:42.444727, colorClass:'marker-color-blue' },
{ name:'信达-开原文化路', lng:124.010049, lat:42.542023, colorClass:'marker-color-blue' },
{ name:'信达-铁岭光荣街', lng:123.837081, lat:42.288715, colorClass:'marker-color-blue' },
{ name:'信达-营口昆仑大街', lng:122.133948, lat:40.265895, colorClass:'marker-color-blue' },
{ name:'信达-大石桥交通街', lng:122.502143, lat:40.632003, colorClass:'marker-color-blue' },
{ name:'信达-盖州红旗大街', lng:122.360025, lat:40.404390, colorClass:'marker-color-blue' },
{ name:'信达-营口光华路', lng:122.256127, lat:40.671276, colorClass:'marker-color-blue' },
{ name:'信达-山东第一分公司', lng:117.105848, lat:36.660316, colorClass:'marker-color-blue' },
{ name:'信达-青岛珠江路', lng:120.187686, lat:35.950289, colorClass:'marker-color-blue' },
{ name:'信达-山东分公司', lng:117.105848, lat:36.660316, colorClass:'marker-color-blue' },
{ name:'信达-太原长风街', lng:112.548084, lat:37.818249, colorClass:'marker-color-blue' },
{ name:'信达-上海分公司', lng:121.489383, lat:31.258525, colorClass:'marker-color-blue' },
{ name:'信达-上海黄浦区南京西路', lng:121.470290, lat:31.232354, colorClass:'marker-color-blue' },
{ name:'信达-上海闵行区七莘路', lng:121.367051, lat:31.128688, colorClass:'marker-color-blue' },
{ name:'信达-上海浦东新区源深路', lng:112.196515, lat:32.095975, colorClass:'marker-color-blue' },
{ name:'信达-上海铁岭路', lng:121.514463, lat:31.278459, colorClass:'marker-color-blue' },
{ name:'信达-成都交子大道', lng:104.057355, lat:30.581531, colorClass:'marker-color-blue' },
{ name:'信达-四川分公司', lng:104.017891, lat:30.767845, colorClass:'marker-color-blue' },
{ name:'信达-成都通锦桥路', lng:104.057558, lat:30.677159, colorClass:'marker-color-blue' },
{ name:'信达-天津分公司', lng:117.203967, lat:39.098083, colorClass:'marker-color-blue' },
{ name:'信达-杭州景昙路', lng:120.250719, lat:30.181044, colorClass:'marker-color-blue' },
{ name:'信达-浙江分公司', lng:120.203510, lat:30.259086, colorClass:'marker-color-blue' },
{ name:'信达-东阳江滨北街', lng:120.235741, lat:29.290407, colorClass:'marker-color-blue' },
{ name:'信达-金华李渔路', lng:119.653205, lat:29.101024, colorClass:'marker-color-blue' },
{ name:'信达-义乌江滨北路', lng:120.102290, lat:29.319886, colorClass:'marker-color-blue' },
{ name:'信达-宁波分公司', lng:121.614892, lat:29.862706, colorClass:'marker-color-blue' },
{ name:'信达-江山城北广场', lng:118.632859, lat:28.744176, colorClass:'marker-color-blue' },
{ name:'信达-绍兴解放大道', lng:120.579959, lat:30.035052, colorClass:'marker-color-blue' },
{ name:'信达-台州玉兰路', lng:121.406464, lat:28.659460, colorClass:'marker-color-blue' },
{ name:'信达-温岭汇龙路', lng:121.361001, lat:28.394234, colorClass:'marker-color-blue' },
{ name:'信达-仙居庆丰街', lng:120.731238, lat:28.855352, colorClass:'marker-color-blue' },
{ name:'信达-温州瓯江路', lng:120.520955, lat:27.582069, colorClass:'marker-color-blue' },
{ name:'信达-重庆分公司', lng:106.587966, lat:29.565492, colorClass:'marker-color-blue' },
{ name:'中金-安庆菱湖南路', lng:117.050794, lat:30.513176, colorClass:'marker-color-red' },
{ name:'中金-肥东公园路', lng:117.467866, lat:31.887310, colorClass:'marker-color-red' },
{ name:'中金-安徽分公司', lng:117.231510, lat:31.799784, colorClass:'marker-color-red' },
{ name:'中金-合肥黄山路', lng:117.233392, lat:31.840379, colorClass:'marker-color-red' },
{ name:'中金-淮北黎苑路', lng:116.798312, lat:33.958360, colorClass:'marker-color-red' },
{ name:'中金-六安梅山南路', lng:116.512131, lat:31.729741, colorClass:'marker-color-red' },
{ name:'中金-马鞍山太白大道', lng:118.505693, lat:31.660371, colorClass:'marker-color-red' },
{ name:'中金-芜湖九华中路', lng:118.380810, lat:31.330916, colorClass:'marker-color-red' },
{ name:'中金-宣城敬亭路', lng:118.748021, lat:30.959232, colorClass:'marker-color-red' },
{ name:'中金-北京亚运村', lng:116.405822, lat:39.991408, colorClass:'marker-color-red' },
{ name:'中金-北京望京启阳路', lng:116.486441, lat:39.994425, colorClass:'marker-color-red' },
{ name:'中金-北京建国门外大街', lng:116.458265, lat:39.907160, colorClass:'marker-color-red' },
{ name:'中金-北京北三环东路', lng:116.410000, lat:39.968222, colorClass:'marker-color-red' },
{ name:'中金-北京分公司&丽泽路营业部', lng:116.322654, lat:39.867161, colorClass:'marker-color-red' },
{ name:'中金-北京宋庄路', lng:116.426283, lat:39.845591, colorClass:'marker-color-red' },
{ name:'中金-北京丰台北路', lng:116.306211, lat:39.866027, colorClass:'marker-color-red' },
{ name:'中金-北京万寿路', lng:116.294330, lat:39.909517, colorClass:'marker-color-red' },
{ name:'中金-北京科学院南路', lng:116.325075, lat:39.983600, colorClass:'marker-color-red' },
{ name:'中金-北京石景山', lng:116.154276, lat:39.918920, colorClass:'marker-color-red' },
{ name:'中金-北京通州', lng:116.659473, lat:39.920704, colorClass:'marker-color-red' },
{ name:'中金-北京阜成门外大街', lng:116.354190, lat:39.922833, colorClass:'marker-color-red' },
{ name:'中金-福州分公司&五四路营业部', lng:119.307274, lat:26.092818, colorClass:'marker-color-red' },
{ name:'中金-平潭西航路', lng:119.801025, lat:25.500990, colorClass:'marker-color-red' },
{ name:'中金-泉州丰泽街', lng:118.606794, lat:24.903007, colorClass:'marker-color-red' },
{ name:'中金-晋江世纪大道', lng:118.567146, lat:24.804328, colorClass:'marker-color-red' },
{ name:'中金-厦门分公司&湖滨东路营业部', lng:118.110887, lat:24.473343, colorClass:'marker-color-red' },
{ name:'中金-漳州九龙大道', lng:117.682295, lat:24.499086, colorClass:'marker-color-red' },
{ name:'中金-青海油田', lng:94.594986, lat:40.116495, colorClass:'marker-color-red' },
{ name:'中金-兰州南滨河路', lng:103.841794, lat:36.062281, colorClass:'marker-color-red' },
{ name:'中金-潮州东兴南路', lng:116.659336, lat:23.652577, colorClass:'marker-color-red' },
{ name:'中金-东莞分公司', lng:113.762395, lat:23.013334, colorClass:'marker-color-red' },
{ name:'中金-东莞虎门', lng:113.682994, lat:22.823378, colorClass:'marker-color-red' },
{ name:'中金-东莞塘厦', lng:114.076902, lat:22.807135, colorClass:'marker-color-red' },
{ name:'中金-东莞长安德政中路', lng:113.800488, lat:22.814633, colorClass:'marker-color-red' },
{ name:'中金-佛山季华五路', lng:113.122741, lat:23.013154, colorClass:'marker-color-red' },
{ name:'中金-佛山南海桂城灯湖东路', lng:113.150536, lat:23.063521, colorClass:'marker-color-red' },
{ name:'中金-佛山分公司', lng:113.295852, lat:22.795850, colorClass:'marker-color-red' },
{ name:'中金-佛山顺德北滘诚德路', lng:113.216170, lat:22.931563, colorClass:'marker-color-red' },
{ name:'中金-广州番禺汉溪大道东', lng:113.327939, lat:22.992031, colorClass:'marker-color-red' },
{ name:'中金-广州番禺东兴路', lng:113.387968, lat:22.928388, colorClass:'marker-color-red' },
{ name:'中金-广州花都保利金融中心', lng:113.222824, lat:23.402593, colorClass:'marker-color-red' },
{ name:'中金-广州科学大道', lng:113.432059, lat:23.164395, colorClass:'marker-color-red' },
{ name:'中金-广东&广州分公司', lng:113.327275, lat:23.117446, colorClass:'marker-color-red' },
{ name:'中金-广州体育东路', lng:113.327600, lat:23.138633, colorClass:'marker-color-red' },
{ name:'中金-广州华夏路', lng:113.321804, lat:23.117323, colorClass:'marker-color-red' },
{ name:'中金-广州天河路', lng:113.310958, lat:23.134779, colorClass:'marker-color-red' },
{ name:'中金-广州海珠广场', lng:113.264685, lat:23.112839, colorClass:'marker-color-red' },
{ name:'中金-惠州文昌一路', lng:114.417054, lat:23.105236, colorClass:'marker-color-red' },
{ name:'中金-江门迎宾大道', lng:113.081820, lat:22.600763, colorClass:'marker-color-red' },
{ name:'中金-江门新会启超大道', lng:113.054647, lat:22.497212, colorClass:'marker-color-red' },
{ name:'中金-茂名西粤北路', lng:110.942439, lat:21.673480, colorClass:'marker-color-red' },
{ name:'中金-汕头东厦路', lng:116.705692, lat:23.353014, colorClass:'marker-color-red' },
{ name:'中金-深圳壹方中心', lng:113.887353, lat:22.553150, colorClass:'marker-color-red' },
{ name:'中金-深圳宝安中心路', lng:113.829913, lat:22.729340, colorClass:'marker-color-red' },
{ name:'中金-深圳分公司', lng:114.057463, lat:22.535790, colorClass:'marker-color-red' },
{ name:'中金-深圳深业上城', lng:114.070265, lat:22.555965, colorClass:'marker-color-red' },
{ name:'中金-深圳深南大道时代科技大厦', lng:114.023820, lat:22.537015, colorClass:'marker-color-red' },
{ name:'中金-深圳五和大道', lng:114.059612, lat:22.604769, colorClass:'marker-color-red' },
{ name:'中金-深圳龙岗龙平西路', lng:114.225123, lat:22.729501, colorClass:'marker-color-red' },
{ name:'中金-深圳坪山大道', lng:114.334193, lat:22.681510, colorClass:'marker-color-red' },
{ name:'中金-深圳桃园路', lng:114.107258, lat:22.558166, colorClass:'marker-color-red' },
{ name:'中金-深圳益田路', lng:114.055430, lat:22.543052, colorClass:'marker-color-red' },
{ name:'中金-粤海分公司&中金大厦营业部', lng:113.944935, lat:22.517223, colorClass:'marker-color-red' },
{ name:'中金-深圳金地威新中心', lng:113.951307, lat:22.528523, colorClass:'marker-color-red' },
{ name:'中金-深圳华侨城', lng:113.983004, lat:22.534424, colorClass:'marker-color-red' },
{ name:'中金-阳江盈信广场', lng:111.995395, lat:21.863561, colorClass:'marker-color-red' },
{ name:'中金-阳江江朗大道', lng:111.984481, lat:21.831627, colorClass:'marker-color-red' },
{ name:'中金-阳江阳春朝南路', lng:111.789268, lat:22.165176, colorClass:'marker-color-red' },
{ name:'中金-云浮新兴东堤北路', lng:112.242431, lat:22.714504, colorClass:'marker-color-red' },
{ name:'中金-湛江乐山路', lng:110.399923, lat:21.235565, colorClass:'marker-color-red' },
{ name:'中金-湛江吴川海港大道', lng:110.783008, lat:21.411063, colorClass:'marker-color-red' },
{ name:'中金-中山博爱五路', lng:113.393453, lat:22.502819, colorClass:'marker-color-red' },
{ name:'中金-中山小榄升平东路', lng:113.253377, lat:22.671324, colorClass:'marker-color-red' },
{ name:'中金-珠海情侣南路', lng:113.559153, lat:22.219735, colorClass:'marker-color-red' },
{ name:'中金-南宁民族大道', lng:108.392149, lat:22.810432, colorClass:'marker-color-red' },
{ name:'中金-贵州分公司', lng:106.713055, lat:26.578046, colorClass:'marker-color-red' },
{ name:'中金-海南分公司', lng:110.265283, lat:20.012686, colorClass:'marker-color-red' },
{ name:'中金-保定朝阳北大街', lng:115.466677, lat:38.909003, colorClass:'marker-color-red' },
{ name:'中金-承德翠桥路', lng:117.936694, lat:40.966465, colorClass:'marker-color-red' },
{ name:'中金-石家庄自强路', lng:114.475066, lat:38.039641, colorClass:'marker-color-red' },
{ name:'中金-唐山金融中心', lng:118.155288, lat:39.646215, colorClass:'marker-color-red' },
{ name:'中金-安阳中华路', lng:114.388735, lat:36.093327, colorClass:'marker-color-red' },
{ name:'中金-洛阳天津路', lng:112.392760, lat:34.655894, colorClass:'marker-color-red' },
{ name:'中金-信阳新六大街', lng:114.080480, lat:32.147123, colorClass:'marker-color-red' },
{ name:'中金-登封大禹路', lng:113.028258, lat:34.468994, colorClass:'marker-color-red' },
{ name:'中金-河南分公司&如意西路', lng:113.776853, lat:34.758582, colorClass:'marker-color-red' },
{ name:'中金-郑州建设路', lng:113.621320, lat:34.755588, colorClass:'marker-color-red' },
{ name:'中金-大庆昆仑大街', lng:125.130150, lat:46.605957, colorClass:'marker-color-red' },
{ name:'中金-哈尔滨紫园路', lng:126.606534, lat:45.765789, colorClass:'marker-color-red' },
{ name:'中金-哈尔滨赣水路', lng:126.675404, lat:45.743489, colorClass:'marker-color-red' },
{ name:'中金-荆州公园路', lng:112.246554, lat:30.313332, colorClass:'marker-color-red' },
{ name:'中金-潜江五七大道', lng:112.701253, lat:30.454652, colorClass:'marker-color-red' },
{ name:'中金-潜江江汉路', lng:115.048993, lat:30.136913, colorClass:'marker-color-red' },
{ name:'中金-武汉关山大道', lng:114.414958, lat:30.493384, colorClass:'marker-color-red' },
{ name:'中金-武汉中山大道', lng:114.310914, lat:30.611109, colorClass:'marker-color-red' },
{ name:'中金-武汉香港路', lng:114.292786, lat:30.595549, colorClass:'marker-color-red' },
{ name:'中金-武汉京汉大道', lng:114.275481, lat:30.578036, colorClass:'marker-color-red' },
{ name:'中金-湖北分公司&中北路营业部', lng:114.338163, lat:30.549747, colorClass:'marker-color-red' },
{ name:'中金-襄阳檀溪路', lng:112.112302, lat:32.007329, colorClass:'marker-color-red' },
{ name:'中金-宜昌沿江大道', lng:111.302071, lat:30.683404, colorClass:'marker-color-red' },
{ name:'中金-湘潭双拥中路', lng:112.943370, lat:27.840016, colorClass:'marker-color-red' },
{ name:'中金-岳阳金鹗中路', lng:113.125876, lat:29.357029, colorClass:'marker-color-red' },
{ name:'中金-长沙解放西路', lng:112.979277, lat:28.191746, colorClass:'marker-color-red' },
{ name:'中金-长沙湘江中路', lng:112.969898, lat:28.188993, colorClass:'marker-color-red' },
{ name:'中金-株洲珠江北路', lng:113.119470, lat:27.823920, colorClass:'marker-color-red' },
{ name:'中金-长春长春大街', lng:125.326920, lat:43.888219, colorClass:'marker-color-red' },
{ name:'中金-溧阳煤建路', lng:119.481550, lat:31.430954, colorClass:'marker-color-red' },
{ name:'中金-常州延政中路', lng:119.952424, lat:31.696270, colorClass:'marker-color-red' },
{ name:'中金-常州通江南路', lng:119.954365, lat:31.794124, colorClass:'marker-color-red' },
{ name:'中金-淮安市淮安区永怀东路', lng:119.157116, lat:33.512231, colorClass:'marker-color-red' },
{ name:'中金-淮安水渡口大道', lng:119.054277, lat:33.600900, colorClass:'marker-color-red' },
{ name:'中金-连云港苍梧路', lng:119.208589, lat:34.600687, colorClass:'marker-color-red' },
{ name:'中金-江苏分公司&汉中路营业部', lng:118.782974, lat:32.043668, colorClass:'marker-color-red' },
{ name:'中金-南京中央路', lng:118.783405, lat:32.084075, colorClass:'marker-color-red' },
{ name:'中金-南京庐山路', lng:118.726889, lat:31.997627, colorClass:'marker-color-red' },
{ name:'中金-南京龙蟠中路', lng:118.804314, lat:32.035421, colorClass:'marker-color-red' },
{ name:'中金-南通工农路', lng:120.884436, lat:32.002569, colorClass:'marker-color-red' },
{ name:'中金-南通如东青园北路', lng:121.183123, lat:32.310027, colorClass:'marker-color-red' },
{ name:'中金-苏州中心', lng:120.679549, lat:31.314774, colorClass:'marker-color-red' },
{ name:'中金-苏州苏绣路', lng:120.677617, lat:31.319706, colorClass:'marker-color-red' },
{ name:'中金-苏州市昆山创业路', lng:120.947952, lat:31.356214, colorClass:'marker-color-red' },
{ name:'中金-吴江中山南路', lng:120.643181, lat:31.158035, colorClass:'marker-color-red' },
{ name:'中金-苏州盛泽敦煌路', lng:120.607802, lat:30.902226, colorClass:'marker-color-red' },
{ name:'中金-宿迁洪泽湖路', lng:118.322675, lat:33.952193, colorClass:'marker-color-red' },
{ name:'中金-靖江人民南路', lng:120.264229, lat:31.999029, colorClass:'marker-color-red' },
{ name:'中金-无锡分公司', lng:120.297378, lat:31.574363, colorClass:'marker-color-red' },
{ name:'中金-江阴朝阳路', lng:120.282241, lat:31.912824, colorClass:'marker-color-red' },
{ name:'中金-宜兴阳羡东路', lng:119.834403, lat:31.369758, colorClass:'marker-color-red' },
{ name:'中金-徐州煤港路', lng:117.177266, lat:34.260157, colorClass:'marker-color-red' },
{ name:'中金-扬州文昌西路', lng:119.388591, lat:32.391557, colorClass:'marker-color-red' },
{ name:'中金-扬州文昌东路', lng:119.575564, lat:32.402444, colorClass:'marker-color-red' },
{ name:'中金-仪征大庆北路', lng:119.172526, lat:32.283660, colorClass:'marker-color-red' },
{ name:'中金-镇江中山东路', lng:119.453688, lat:32.203589, colorClass:'marker-color-red' },
{ name:'中金-南昌红谷中大道', lng:115.864020, lat:28.689843, colorClass:'marker-color-red' },
{ name:'中金-鞍山南胜利路', lng:122.995076, lat:41.107073, colorClass:'marker-color-red' },
{ name:'中金-大连星海广场', lng:121.588896, lat:38.891208, colorClass:'marker-color-red' },
{ name:'中金-大连港兴路', lng:121.670377, lat:38.927906, colorClass:'marker-color-red' },
{ name:'中金-沈阳天成街', lng:123.465660, lat:41.749862, colorClass:'marker-color-red' },
{ name:'中金-辽宁分公司', lng:123.434706, lat:41.776835, colorClass:'marker-color-red' },
{ name:'中金-沈阳友好街', lng:123.438580, lat:41.814365, colorClass:'marker-color-red' },
{ name:'中金-沈阳青年大街', lng:123.436453, lat:41.775145, colorClass:'marker-color-red' },
{ name:'中金-铁岭银州路', lng:123.839003, lat:42.293368, colorClass:'marker-color-red' },
{ name:'中金-鄂尔多斯沙日乌素路', lng:109.968234, lat:39.824012, colorClass:'marker-color-red' },
{ name:'中金-呼和浩特腾飞路', lng:111.762211, lat:40.809147, colorClass:'marker-color-red' },
{ name:'中金-银川北京中路', lng:106.207475, lat:38.485382, colorClass:'marker-color-red' },
{ name:'中金-青海分公司&西宁营业部', lng:101.712673, lat:36.648852, colorClass:'marker-color-red' },
{ name:'中金-山东分公司', lng:117.097585, lat:36.654835, colorClass:'marker-color-red' },
{ name:'中金-济南龙奥西路', lng:117.115884, lat:36.650851, colorClass:'marker-color-red' },
{ name:'中金-济宁环城西路', lng:116.573770, lat:35.418506, colorClass:'marker-color-red' },
{ name:'中金-聊城东昌东路', lng:116.000670, lat:36.457780, colorClass:'marker-color-red' },
{ name:'中金-临沂沂蒙北路', lng:118.344868, lat:35.104644, colorClass:'marker-color-red' },
{ name:'中金-青岛上实中心', lng:120.460559, lat:36.099595, colorClass:'marker-color-red' },
{ name:'中金-青岛香港中路', lng:120.379186, lat:36.064548, colorClass:'marker-color-red' },
{ name:'中金-威海青岛北路', lng:122.134864, lat:37.479378, colorClass:'marker-color-red' },
{ name:'中金-潍坊胜利东街', lng:119.113485, lat:36.707238, colorClass:'marker-color-red' },
{ name:'中金-烟台黄海路', lng:121.448160, lat:37.489557, colorClass:'marker-color-red' },
{ name:'中金-淄博柳泉路', lng:118.057015, lat:36.840896, colorClass:'marker-color-red' },
{ name:'中金-太原晋祠路', lng:112.531478, lat:37.854455, colorClass:'marker-color-red' },
{ name:'中金-运城周西路', lng:111.039040, lat:35.037920, colorClass:'marker-color-red' },
{ name:'中金-汉中兴元路', lng:107.002278, lat:33.076552, colorClass:'marker-color-red' },
{ name:'中金-陕西分公司', lng:108.988747, lat:34.195927, colorClass:'marker-color-red' },
{ name:'中金-西安雁塔', lng:108.935832, lat:34.228568, colorClass:'marker-color-red' },
{ name:'中金-榆林神木', lng:110.468999, lat:38.897203, colorClass:'marker-color-red' },
{ name:'中金-榆林长城南路', lng:109.751667, lat:38.260244, colorClass:'marker-color-red' },
{ name:'中金-上海虹口区北外滩', lng:121.509159, lat:31.250563, colorClass:'marker-color-red' },
{ name:'中金-上海黄浦区中山东二路', lng:121.494514, lat:31.230085, colorClass:'marker-color-red' },
{ name:'中金-上海黄浦区湖滨路', lng:121.477782, lat:31.220561, colorClass:'marker-color-red' },
{ name:'中金-上海静安区灵石路', lng:121.449643, lat:31.284196, colorClass:'marker-color-red' },
{ name:'中金-上海分公司', lng:121.444811, lat:31.221786, colorClass:'marker-color-red' },
{ name:'中金-上海临港新片区', lng:121.929127, lat:30.908623, colorClass:'marker-color-red' },
{ name:'中金-上海浦东新区民生路', lng:121.549885, lat:31.226739, colorClass:'marker-color-red' },
{ name:'中金-上海浦东新区陆家嘴环路', lng:121.504164, lat:31.240987, colorClass:'marker-color-red' },
{ name:'中金-上海徐汇区淮海中路', lng:121.456413, lat:31.215104, colorClass:'marker-color-red' },
{ name:'中金-上海杨浦区黄兴路', lng:121.517431, lat:31.299654, colorClass:'marker-color-red' },
{ name:'中金-上海长宁区红宝石路', lng:121.404385, lat:31.197784, colorClass:'marker-color-red' },
{ name:'中金-四川分公司', lng:104.065019, lat:30.581655, colorClass:'marker-color-red' },
{ name:'中金-成都天府大道', lng:104.070477, lat:30.584991, colorClass:'marker-color-red' },
{ name:'中金-成都一环路北三段万达广场', lng:104.074304, lat:30.686145, colorClass:'marker-color-red' },
{ name:'中金-成都东御街', lng:104.066590, lat:30.655943, colorClass:'marker-color-red' },
{ name:'中金-成都滨江东路', lng:104.086261, lat:30.642881, colorClass:'marker-color-red' },
{ name:'中金-成都天府新区汉州路', lng:104.081359, lat:30.433428, colorClass:'marker-color-red' },
{ name:'中金-成都华府大道', lng:104.068366, lat:30.526463, colorClass:'marker-color-red' },
{ name:'中金-成都温江光华大道', lng:103.856166, lat:30.688791, colorClass:'marker-color-red' },
{ name:'中金-成都武阳大道', lng:104.022872, lat:30.624651, colorClass:'marker-color-red' },
{ name:'中金-成都新都蓉都大道', lng:104.169893, lat:30.821478, colorClass:'marker-color-red' },
{ name:'中金-广汉韶山路', lng:104.269548, lat:30.979398, colorClass:'marker-color-red' },
{ name:'中金-德阳泰山南路', lng:104.390671, lat:31.101698, colorClass:'marker-color-red' },
{ name:'中金-乐山凤凰路', lng:103.747541, lat:29.589628, colorClass:'marker-color-red' },
{ name:'中金-眉山眉州大道', lng:103.846503, lat:30.074566, colorClass:'marker-color-red' },
{ name:'中金-绵阳市', lng:104.746148, lat:31.469530, colorClass:'marker-color-red' },
{ name:'中金-南充白土坝路', lng:106.078803, lat:30.808995, colorClass:'marker-color-red' },
{ name:'中金-遂宁德水中路', lng:105.589601, lat:30.528600, colorClass:'marker-color-red' },
{ name:'中金-雅安熊猫大道', lng:103.054364, lat:30.014936, colorClass:'marker-color-red' },
{ name:'中金-简阳金融街', lng:104.542632, lat:30.409008, colorClass:'marker-color-red' },
{ name:'中金-自贡丹桂南大街', lng:104.775389, lat:29.316593, colorClass:'marker-color-red' },
{ name:'中金-天津宝坻广阳路', lng:117.302485, lat:39.693307, colorClass:'marker-color-red' },
{ name:'中金-天津滨海新区', lng:117.704413, lat:39.022652, colorClass:'marker-color-red' },
{ name:'中金-天津南京路', lng:117.193045, lat:39.119243, colorClass:'marker-color-red' },
{ name:'中金-天津分公司&五大道营业部', lng:117.203352, lat:39.106990, colorClass:'marker-color-red' },
{ name:'中金-天津北马路', lng:117.174122, lat:39.146985, colorClass:'marker-color-red' },
{ name:'中金-天津蓟州兴华大街', lng:117.244029, lat:39.891986, colorClass:'marker-color-red' },
{ name:'中金-天津武清翠通路', lng:117.021981, lat:39.394279, colorClass:'marker-color-red' },
{ name:'中金-拉萨林廓西路', lng:91.112316, lat:29.655063, colorClass:'marker-color-red' },
{ name:'中金-乌鲁木齐红光山路', lng:87.611723, lat:43.873631, colorClass:'marker-color-red' },
{ name:'中金-云南分公司', lng:102.722608, lat:25.036729, colorClass:'marker-color-red' },
{ name:'中金-浙江分公司', lng:120.213051, lat:30.248772, colorClass:'marker-color-red' },
{ name:'中金-杭州江河汇', lng:120.231582, lat:30.265656, colorClass:'marker-color-red' },
{ name:'中金-杭州教工路', lng:120.137278, lat:30.273331, colorClass:'marker-color-red' },
{ name:'中金-杭州环城北路', lng:120.161519, lat:30.273850, colorClass:'marker-color-red' },
{ name:'中金-湖州仁皇山路', lng:120.091551, lat:30.894245, colorClass:'marker-color-red' },
{ name:'中金-海宁海州西路', lng:120.687883, lat:30.510711, colorClass:'marker-color-red' },
{ name:'中金-嘉兴花园路', lng:120.757624, lat:30.740171, colorClass:'marker-color-red' },
{ name:'中金-桐乡新永丰路', lng:120.557597, lat:30.633154, colorClass:'marker-color-red' },
{ name:'中金-金华光南路', lng:119.680963, lat:29.129275, colorClass:'marker-color-red' },
{ name:'中金-宁波狮子街', lng:121.557392, lat:29.866118, colorClass:'marker-color-red' },
{ name:'中金-宁波海晏北路', lng:121.615659, lat:29.864967, colorClass:'marker-color-red' },
{ name:'中金-衢州花园大道', lng:118.851101, lat:28.974894, colorClass:'marker-color-red' },
{ name:'中金-绍兴洋江西路', lng:120.588645, lat:30.049072, colorClass:'marker-color-red' },
{ name:'中金-台州解放南路', lng:121.434756, lat:28.668930, colorClass:'marker-color-red' },
{ name:'中金-温州锦绣路', lng:120.664475, lat:27.997809, colorClass:'marker-color-red' },
{ name:'中金-重庆江北嘴', lng:106.574388, lat:29.575327, colorClass:'marker-color-red' },
{ name:'中金-重庆两江新区', lng:106.516469, lat:29.611210, colorClass:'marker-color-red' },
{ name:'中金-重庆市渝中区', lng:106.514403, lat:29.549386, colorClass:'marker-color-red' }
        ];
        const fixedMarkers = [];
		
		// 新增：标记显示/隐藏控制函数
		function toggleMarkerByColor(color, isShow) {
		  const colorKey = `marker-color-${color}`;
		  if (!colorMarkerGroups[colorKey]) return;
		  
		    // 新增：同步更新筛选状态
			updateFilterStatus(color, isShow);
		  
		  // 控制标记和标签的显示/隐藏（仅修改图层可见性，不修改坐标）
		  colorMarkerGroups[colorKey].markers.forEach(marker => {
			if (isShow) {
			  marker.addTo(map); // 显示：添加到地图
			} else {
			  marker.removeFrom(map); // 隐藏：从地图移除（坐标数据保留）
			}
		  });
		  colorMarkerGroups[colorKey].labels.forEach(label => {
			if (isShow) {
			  label.addTo(map);
			} else {
			  label.removeFrom(map);
			}
		  });
		}
		
		// 新增：存储筛选状态（默认全部启用）
		const filterStatus = {
		  green: true,
		  blue: true,
		  red: true
		};

		// 新增：更新筛选状态的函数（和按钮点击联动）
		function updateFilterStatus(color, isShow) {
		  filterStatus[color] = isShow;
		}


        // 省市数据
        const provinceCityData = {
            "北京市": ["北京市"], "天津市": ["天津市"], "上海市": ["上海市"], "重庆市": ["重庆市"],
            "河北省": ["石家庄市", "唐山市", "秦皇岛市", "邯郸市", "邢台市", "保定市", "张家口市", "承德市", "沧州市", "廊坊市", "衡水市"],
            "山西省": ["太原市", "大同市", "阳泉市", "长治市", "晋城市", "朔州市", "晋中市", "运城市", "忻州市", "临汾市", "吕梁市"],
            "辽宁省": ["沈阳市", "大连市", "鞍山市", "抚顺市", "本溪市", "丹东市", "锦州市", "营口市", "阜新市", "辽阳市", "盘锦市", "铁岭市", "朝阳市", "葫芦岛市"],
            "吉林省": ["长春市", "吉林市", "四平市", "辽源市", "通化市", "白山市", "松原市", "白城市", "延边朝鲜族自治州"],
            "黑龙江省": ["哈尔滨市", "齐齐哈尔市", "鸡西市", "鹤岗市", "双鸭山市", "大庆市", "伊春市", "佳木斯市", "七台河市", "牡丹江市", "黑河市", "绥化市", "大兴安岭地区"],
            "江苏省": ["南京市", "无锡市", "徐州市", "常州市", "苏州市", "南通市", "连云港市", "淮安市", "盐城市", "扬州市", "镇江市", "泰州市", "宿迁市"],
            "浙江省": ["杭州市", "宁波市", "温州市", "嘉兴市", "湖州市", "绍兴市", "金华市", "衢州市", "舟山市", "台州市", "丽水市"],
            "安徽省": ["合肥市", "芜湖市", "蚌埠市", "淮南市", "马鞍山市", "淮北市", "铜陵市", "安庆市", "黄山市", "滁州市", "阜阳市", "宿州市", "六安市", "亳州市", "池州市", "宣城市"],
            "福建省": ["福州市", "厦门市", "莆田市", "三明市", "泉州市", "漳州市", "南平市", "龙岩市", "宁德市"],
            "江西省": ["南昌市", "景德镇市", "萍乡市", "九江市", "新余市", "鹰潭市", "赣州市", "吉安市", "宜春市", "抚州市", "上饶市"],
            "山东省": ["济南市", "青岛市", "淄博市", "枣庄市", "东营市", "烟台市", "潍坊市", "济宁市", "泰安市", "威海市", "日照市", "临沂市", "德州市", "聊城市", "滨州市", "菏泽市"],
            "河南省": ["郑州市", "开封市", "洛阳市", "平顶山市", "安阳市", "鹤壁市", "新乡市", "焦作市", "濮阳市", "许昌市", "漯河市", "三门峡市", "南阳市", "商丘市", "信阳市", "周口市", "驻马店市"],
            "湖北省": ["武汉市", "黄石市", "十堰市", "宜昌市", "襄阳市", "鄂州市", "荆门市", "孝感市", "荆州市", "黄冈市", "咸宁市", "随州市", "恩施土家族苗族自治州"],
            "湖南省": ["长沙市", "株洲市", "湘潭市", "衡阳市", "邵阳市", "岳阳市", "常德市", "张家界市", "益阳市", "郴州市", "永州市", "怀化市", "娄底市", "湘西土家族苗族自治州"],
            "广东省": ["广州市", "韶关市", "深圳市", "珠海市", "汕头市", "佛山市", "江门市", "湛江市", "茂名市", "肇庆市", "惠州市", "梅州市", "汕尾市", "河源市", "阳江市", "清远市", "东莞市", "中山市", "潮州市", "揭阳市", "云浮市"],
            "广西壮族自治区": ["南宁市", "柳州市", "桂林市", "梧州市", "北海市", "防城港市", "钦州市", "贵港市", "玉林市", "百色市", "贺州市", "河池市", "来宾市", "崇左市"],
            "海南省": ["海口市", "三亚市", "三沙市", "儋州市"],
            "四川省": ["成都市", "自贡市", "攀枝花市", "泸州市", "德阳市", "绵阳市", "广元市", "遂宁市", "内江市", "乐山市", "南充市", "眉山市", "宜宾市", "广安市", "达州市", "雅安市", "巴中市", "资阳市", "阿坝藏族羌族自治州", "甘孜藏族自治州", "凉山彝族自治州"],
            "贵州省": ["贵阳市", "六盘水市", "遵义市", "安顺市", "毕节市", "铜仁市", "黔西南布依族苗族自治州", "黔东南苗族侗族自治州", "黔南布依族苗族自治州"],
            "云南省": ["昆明市", "曲靖市", "玉溪市", "保山市", "昭通市", "丽江市", "普洱市", "临沧市", "楚雄彝族自治州", "红河哈尼族彝族自治州", "文山壮族苗族自治州", "西双版纳傣族自治州", "大理白族自治州", "德宏傣族景颇族自治州", "怒江傈僳族自治州", "迪庆藏族自治州"],
            "西藏自治区": ["拉萨市", "日喀则市", "昌都市", "林芝市", "山南市", "那曲市", "阿里地区"],
            "陕西省": ["西安市", "铜川市", "宝鸡市", "咸阳市", "渭南市", "延安市", "汉中市", "榆林市", "安康市", "商洛市"],
            "甘肃省": ["兰州市", "嘉峪关市", "金昌市", "白银市", "天水市", "武威市", "张掖市", "平凉市", "酒泉市", "庆阳市", "定西市", "陇南市", "临夏回族自治州", "甘南藏族自治州"],
            "青海省": ["西宁市", "海东市", "海北藏族自治州", "黄南藏族自治州", "海南藏族自治州", "果洛藏族自治州", "玉树藏族自治州", "海西蒙古族藏族自治州"],
            "宁夏回族自治区": ["银川市", "石嘴山市", "吴忠市", "固原市", "中卫市"],
            "新疆维吾尔自治区": ["乌鲁木齐市", "克拉玛依市", "吐鲁番市", "哈密市", "昌吉回族自治州", "博尔塔拉蒙古自治州", "巴音郭楞蒙古自治州", "阿克苏地区", "克孜勒苏柯尔克孜自治州", "喀什地区", "和田地区", "伊犁哈萨克自治州", "塔城地区", "阿勒泰地区"],
            "台湾省": ["台北市", "新北市", "桃园市", "台中市", "台南市", "高雄市"],
            "香港特别行政区": ["香港特别行政区"], "澳门特别行政区": ["澳门特别行政区"]
        };
		
		// 新增：省份-省会映射表（覆盖所有省份/自治区/直辖市）
		const provinceCapitalMap = {
		  "北京市": "北京市",
		  "天津市": "天津市",
		  "上海市": "上海市",
		  "重庆市": "重庆市",
		  "河北省": "石家庄市",
		  "山西省": "太原市",
		  "辽宁省": "沈阳市",
		  "吉林省": "长春市",
		  "黑龙江省": "哈尔滨市",
		  "江苏省": "南京市",
		  "浙江省": "杭州市",
		  "安徽省": "合肥市",
		  "福建省": "福州市",
		  "江西省": "南昌市",
		  "山东省": "济南市",
		  "河南省": "郑州市",
		  "湖北省": "武汉市",
		  "湖南省": "长沙市",
		  "广东省": "广州市",
		  "广西壮族自治区": "南宁市",
		  "海南省": "海口市",
		  "四川省": "成都市",
		  "贵州省": "贵阳市",
		  "云南省": "昆明市",
		  "西藏自治区": "拉萨市",
		  "陕西省": "西安市",
		  "甘肃省": "兰州市",
		  "青海省": "西宁市",
		  "宁夏回族自治区": "银川市",
		  "新疆维吾尔自治区": "乌鲁木齐市",
		  "台湾省": "台北市",
		  "香港特别行政区": "香港特别行政区",
		  "澳门特别行政区": "澳门特别行政区"
		};
		
        const areaCenterCoords = {
            "北京市": { latlng: [39.914885, 116.403874], zoom: 14 }, "天津市": { latlng: [39.084158, 117.200983], zoom: 10 },
            "上海市": { latlng: [31.230416, 121.473701], zoom: 10 }, "重庆市": { latlng: [29.533155, 106.504962], zoom: 10 },
            "石家庄市": { latlng: [38.045475, 114.502464], zoom: 12 }, "太原市": { latlng: [37.857014, 112.548873], zoom: 12 },
            "沈阳市": { latlng: [41.796767, 123.429096], zoom: 12 }, "长春市": { latlng: [43.886841, 125.324501], zoom: 12 },
            "哈尔滨市": { latlng: [45.803775, 126.642464], zoom: 12 }, "南京市": { latlng: [32.060254, 118.796875], zoom: 12 },
            "杭州市": { latlng: [30.287459, 120.153576], zoom: 12 }, "合肥市": { latlng: [31.86119, 117.283042], zoom: 12 },
            "福州市": { latlng: [26.075302, 119.306239], zoom: 12 }, "南昌市": { latlng: [28.676493, 115.892151], zoom: 12 },
            "济南市": { latlng: [36.675808, 117.000923], zoom: 12 }, "郑州市": { latlng: [34.757975, 113.665412], zoom: 12 },
            "武汉市": { latlng: [30.592848, 114.305469], zoom: 12 }, "长沙市": { latlng: [28.19409, 112.982279], zoom: 12 },
            "广州市": { latlng: [23.125178, 113.280637], zoom: 12 }, "南宁市": { latlng: [22.82402, 108.320004], zoom: 12 },
            "成都市": { latlng: [30.659462, 104.065735], zoom: 12 }, "贵阳市": { latlng: [26.578343, 106.713478], zoom: 12 },
            "昆明市": { latlng: [25.040609, 102.712251], zoom: 12 }, "西安市": { latlng: [34.263161, 108.948024], zoom: 12 },
            "兰州市": { latlng: [36.058039, 103.823557], zoom: 12 }, "西宁市": { latlng: [36.617633, 101.778919], zoom: 11 },
            "银川市": { latlng: [38.46637, 106.278179], zoom: 12 }, "乌鲁木齐市": { latlng: [43.792818, 87.617735], zoom: 11 },
			    // 新增指定城市定位
    "深圳市": { latlng: [22.543096, 114.057865], zoom: 12 },
    "烟台市": { latlng: [37.540725, 121.389052], zoom: 12 },
    "东莞市": { latlng: [23.043111, 113.742217], zoom: 12 },
    "苏州市": { latlng: [31.304959, 120.619585], zoom: 12 },
    "常州市": { latlng: [31.799899, 119.976805], zoom: 12 },
    "佛山市": { latlng: [23.020664, 113.106415], zoom: 12 },
    "泉州市": { latlng: [24.905298, 118.656749], zoom: 12 },
    "宁波市": { latlng: [29.868331, 121.548056], zoom: 12 },
    "青岛市": { latlng: [36.067192, 120.382762], zoom: 12 },
    "无锡市": { latlng: [31.597952, 120.301585], zoom: 12 },
    "南通市": { latlng: [31.98998, 120.859828], zoom: 12 }
        };

        // 工具函数
        function calculateTwoPointDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000;
            const radLat1 = Math.PI * lat1 / 180;
            const radLat2 = Math.PI * lat2 / 180;
            const radLon1 = Math.PI * lon1 / 180;
            const radLon2 = Math.PI * lon2 / 180;
            const deltaLat = radLat2 - radLat1;
            const deltaLon = radLon2 - radLon1;
            const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
                      Math.cos(radLat1) * Math.cos(radLat2) *
                      Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // 【关键】仅用原始GCJ坐标计算距离
        function calculateAllPairDistance(points) {
            if (points.length < 2) return [];
            const results = [];
            for (let i = 0; i < points.length; i++) {
                for (let j = i + 1; j < points.length; j++) {
                    const p1 = points[i];
                    const p2 = points[j];
                    // 强制使用原始GCJ坐标计算，忽略拖动后的展示坐标
                    const distM = calculateTwoPointDistance(p1.gcjLat, p1.gcjLon, p2.gcjLat, p2.gcjLon);
                    results.push({
                        pair: `${p1.name} ↔ ${p2.name}`,
                        km: (distM / 1000).toFixed(3),
                        m: Math.round(distM)
                    });
                }
            }
            return results;
        }

        function updateDistanceResult(html) {
            document.getElementById('distanceResult').innerHTML = html;
        }

        // 【关键】选中时仅存储原始GCJ坐标（用于测距），不存储展示坐标
        function toggleMarkerSelect(marker, place) {
            if (!isSelectingMarkers) return;
            const idx = selectedPoints.findIndex(p => p.name === place.name);
            if (idx > -1) {
                marker.getElement().classList.remove('marker-selected');
                selectedPoints.splice(idx, 1);
            } else {
                marker.getElement().classList.add('marker-selected');
                // 仅存储原始GCJ坐标和名称，用于测距
                selectedPoints.push({ 
                    name: place.name, 
                    gcjLat: place.gcjLat, // 原始GCJ纬度（仅这个用于计算）
                    gcjLon: place.gcjLon  // 原始GCJ经度（仅这个用于计算）
                });
            }
            document.getElementById('calcDistanceBtn').disabled = selectedPoints.length < 2;
            updateDistanceResult(selectedPoints.length === 0 
                ? '未选中任何点位，请点击地图标记选择' 
                : `已选中 ${selectedPoints.length} 个点位：${selectedPoints.map(p => p.name).join('、')}`);
        }

        function clearSelectedMarkers() {
            fixedMarkers.forEach(marker => marker.getElement().classList.remove('marker-selected'));
            selectedPoints = [];
            document.getElementById('calcDistanceBtn').disabled = true;
            updateDistanceResult('已清空选中点位，可重新选择计算');
        }

        // 创建标记
        function createMarkerWithLabel(latlng, colorClass, place) {
            const markerIcon = L.icon.colorMarker({ colorClass: colorClass });
            const marker = L.marker(latlng, { 
                icon: markerIcon, 
                draggable: false, // 永久禁用拖动（删除编辑功能）
                place: place 
            });
            const labelIcon = L.divIcon({
                className: 'location-label',
                html: `<span>${place.name}</span>`,
                iconSize: [100, 20],
                iconAnchor: [50, 0]
            });
            const labelMarker = L.marker(latlng, {
                icon: labelIcon,
                interactive: false,
                zIndexOffset: 10,
                offset: L.point(0, 45)
            });
            marker.on('click', () => toggleMarkerSelect(marker, place));
            // 完全删除拖动相关逻辑（编辑功能已移除）
            if (colorMarkerGroups[colorClass]) {
                colorMarkerGroups[colorClass].markers.push(marker);
                colorMarkerGroups[colorClass].labels.push(labelMarker);
            }
            return { marker, labelMarker };
        }

        // 隐藏标记逻辑
        function isMarkerInView(marker) {
            const mapBounds = map.getBounds();
            const markerLatLng = marker.getLatLng();
            return mapBounds.pad(0.01).contains(markerLatLng);
        }


		// 原有函数（需要修改）
		function handleSingleColorMarkerInView(colorClass, zoomThreshold) {
		  const currentZoom = map.getZoom();
		  const colorGroup = colorMarkerGroups[colorClass];
		  if (colorGroup.markers.length === 0) return;

		  // 新增：获取当前颜色的筛选状态（比如green/blue/red）
		  const color = colorClass.replace('marker-color-', '');
		  const isFilterEnabled = filterStatus[color]; // 读取筛选按钮状态
		  
		  const inViewMarkers = [];
		  const inViewLabels = [];
		  colorGroup.markers.forEach((marker, idx) => {
			if (isMarkerInView(marker)) {
			  inViewMarkers.push(marker);
			  inViewLabels.push(colorGroup.labels[idx]);
			}
		  });

		  // 核心修改：先判断筛选状态——如果禁用，直接隐藏所有该颜色标记
		  if (!isFilterEnabled) {
			inViewMarkers.forEach(m => map.removeLayer(m));
			inViewLabels.forEach(l => map.removeLayer(l));
			return; // 禁用状态下，直接返回，不执行后续缩放逻辑
		  }

		  // 原有缩放逻辑（仅在筛选启用时执行）
		  if (currentZoom <= zoomThreshold) {
			inViewMarkers.forEach(m => map.removeLayer(m));
			inViewLabels.forEach(l => map.removeLayer(l));
			if (inViewMarkers.length > 0) {
			  const randomIdx = Math.floor(Math.random() * inViewMarkers.length);
			  map.addLayer(inViewMarkers[randomIdx]);
			  map.addLayer(inViewLabels[randomIdx]);
			}
		  } else {
			inViewMarkers.forEach(m => map.addLayer(m));
			inViewLabels.forEach(l => map.addLayer(l));
		  }
		}
		

        function toggleMarkersByView() {
            const zoomThreshold = 6; 
            handleSingleColorMarkerInView('marker-color-red', zoomThreshold);
            handleSingleColorMarkerInView('marker-color-green', zoomThreshold);
            handleSingleColorMarkerInView('marker-color-blue', zoomThreshold);
        }
		
		// 按钮点击事件（修改后）
		document.querySelectorAll('.filter-btn-sm').forEach(btn => {
		  btn.addEventListener('click', function() {
			this.classList.toggle('active');
			const color = this.dataset.color;
			const isShow = this.classList.contains('active');
			
			// 1. 更新筛选状态
			updateFilterStatus(color, isShow);
			// 2. 控制标记显示/隐藏
			toggleMarkerByColor(color, isShow);
			// 3. 强制触发一次缩放逻辑，确保状态同步
			toggleMarkersByView();
		  });
		});

        // 初始化省市选择框
        function initProvinceCitySelect() {
            const provinceSel = document.getElementById('provinceSelect');
            const citySel = document.getElementById('citySelect');
            Object.keys(provinceCityData).forEach(prov => {
                const opt = document.createElement('option');
                opt.value = prov;
                opt.textContent = prov;
                provinceSel.appendChild(opt);
            });
            provinceSel.value = "北京市";
            provinceSel.addEventListener('change', () => {
                citySel.innerHTML = '<option value="">请选择城市</option>';
                citySel.disabled = !provinceSel.value;
                if (provinceSel.value) {
                    provinceCityData[provinceSel.value].forEach(city => {
                        const opt = document.createElement('option');
                        opt.value = city;
                        opt.textContent = city;
                        citySel.appendChild(opt);
                    });
                    citySel.value = provinceCityData[provinceSel.value][0];
                }
            });
            provinceSel.dispatchEvent(new Event('change'));
			document.getElementById('locationBtn').addEventListener('click', () => {
			  const prov = provinceSel.value;
			  const city = citySel.value;
			  if (!prov) {
				alert("请选择省份！");
				return;
			  }

			  // 1. 判断所选城市是否有坐标，无则用省会坐标（逻辑保留）
			  let targetCoords = null;
			  if (areaCenterCoords[city]) {
				targetCoords = areaCenterCoords[city];
			  } else {
				const capital = provinceCapitalMap[prov];
				targetCoords = areaCenterCoords[capital];
				alert(`当前城市暂无定位数据，已自动定位到${prov}省会：${capital}`);
			  }

			  // 2. 仅移动地图视角到目标位置（核心：不创建任何新标记）
			  map.setView(targetCoords.latlng, targetCoords.zoom);

			  // 3. 更新提示文本（告知仅定位视角，无新标记）
			  const name = city ? `${prov}${city}` : prov;
			  updateDistanceResult(`已定位到：${name}（仅调整地图视角，未添加新坐标），可选择现有点位计算距离`);
			});
        }

        // 初始化地图（核心修改：使用用户输入的密码作为天地图密钥）
        function initMap(password) {
            map = L.map('map', { 
				preferCanvas: true, 
				zoomControl: false, 
				attributionControl: true,
				maxZoom: 18,
				minZoom: 3
			}).setView([39.914885, 116.403874], 14);
			
			// 动态套入用户输入的密码（作为天地图密钥）
			L.tileLayer(`http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=${password}`, {
				subdomains: ['0'],
				maxZoom: 18,
				minZoom: 3,
				crossOrigin: 'anonymous',
				attribution: '© 天地图'
			}).addTo(map);
			L.tileLayer(`http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=${password}`, {
				subdomains: ['0'],
				maxZoom: 18,
				minZoom: 3,
				crossOrigin: 'anonymous'
			}).addTo(map);

            // 加载点位：GCJ转WGS作为初始展示坐标
            PLACES.forEach(place => {
                const wgs = transformGCJ2WGS(place.lat, place.lng);
                const placeWithWGS = {
                    ...place,
                    gcjLat: place.lat, // 原始GCJ坐标（永久保留，用于计算）
                    gcjLon: place.lng,
                    lat: wgs.lat,      // 转换后的展示坐标
                    lng: wgs.lon
                };
                const { marker, labelMarker } = createMarkerWithLabel(
                    [placeWithWGS.lat, placeWithWGS.lng],
                    placeWithWGS.colorClass,
                    placeWithWGS
                );
                marker.addTo(map);
                labelMarker.addTo(map);
                fixedMarkers.push(marker);
            });

            initProvinceCitySelect();
            map.on('zoomend moveend', toggleMarkersByView);
            toggleMarkersByView();

            // 折叠面板
            const controls = document.getElementById('mapControls');
            const collapseBtn = document.getElementById('collapseBtn');
            document.getElementById('controlHeader').addEventListener('click', () => {
                controls.classList.toggle('collapsed');
                collapseBtn.innerText = controls.classList.contains('collapsed') ? '≡' : '≡';
            });

            // 选点模式
            const selectBtn = document.getElementById('selectMarkerBtn');
            selectBtn.addEventListener('click', () => {
                isSelectingMarkers = !isSelectingMarkers;
                selectBtn.classList.toggle('active');
                if (isSelectingMarkers) {
                    selectBtn.innerText = '退出选点模式（点击标记取消/选中）';
                    updateDistanceResult('选点模式已开启，点击标记选择（测距仅用原始GCJ坐标）');
                } else {
                    selectBtn.innerText = '选择点位（点击标记）';
                    clearSelectedMarkers();
                    updateDistanceResult('选点模式已关闭，已自动清空选中点位');
                }
            });

            // 计算距离
            document.getElementById('calcDistanceBtn').addEventListener('click', () => {
                const distances = calculateAllPairDistance(selectedPoints);
                let html = `<strong>选中 ${selectedPoints.length} 个点位，两两距离（原始GCJ坐标）：</strong><br><br>`;
                distances.forEach((d, i) => {
                    html += `${i+1}. ${d.pair}：${d.km} 公里（${d.m} 米）<br><br>`;
                });
                updateDistanceResult(html);
            });

            // 清空选中
            document.getElementById('clearSelectBtn').addEventListener('click', clearSelectedMarkers);
        }

// 页面加载初始化（新增缓存逻辑+密码输入+未输入时完全空白）
window.addEventListener('DOMContentLoaded', () => {
    if (!L) return; // 加载失败也保持空白

    // 缓存相关工具函数
    // 1. 读取缓存的密码（带过期校验）
    function getCachedPassword() {
        try {
            const cached = localStorage.getItem('map_access_password');
            if (!cached) return null;
            
            const { password, expireTime } = JSON.parse(cached);
            // 校验是否过期（7天有效期）
            if (Date.now() > expireTime) {
                localStorage.removeItem('map_access_password');
                return null;
            }
            return password;
        } catch (e) {
            localStorage.removeItem('map_access_password');
            return null;
        }
    }

    // 2. 缓存密码（有效期7天）
    function setCachedPassword(password) {
        try {
            const expireTime = Date.now() + 7 * 24 * 60 * 60 * 1000; // 7天毫秒数
            localStorage.setItem('map_access_password', JSON.stringify({
                password: password,
                expireTime: expireTime
            }));
        } catch (e) {
            console.warn('密码缓存失败:', e);
        }
    }

    // 优先读取缓存密码
    let password = getCachedPassword();
    
    // 缓存无有效密码则弹窗输入
    if (!password) {
        password = prompt('请输入访问密码（必填）：', '');
        
        // 未输入密码：保持空白
        if (!password || password.trim() === '') {
            return;
        }
        
        // 输入密码后缓存（7天有效期）
        setCachedPassword(password.trim());
    }

    // 显示地图和面板，初始化
    document.getElementById('map').style.display = 'block';
    document.getElementById('mapControls').style.display = 'block';
    initMap(password.trim());
});
    </script>
</body>
</html>



